<!DOCTYPE html>
<html lang="pt-br" class="h-full bg-slate-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Comparativo PRODs (Dados 2024)</title>
    <!-- Favicon do CIASC -->
    <link rel="icon" href="https://ciasc.sc.gov.br/wp-content/uploads/2022/09/Logo_simboloCIASC.png" type="image/png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Inter -->
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="h-full flex flex-col min-h-screen">

    <!-- Header (Cabeçalho com logo do CIASC) -->
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-20">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" aria-label="Top">
            <div class="w-full py-4 flex items-center justify-between">
                <div class="flex items-center">
                    <a href="#">
                        <span class="sr-only">CIASC</span>
                        <img class="h-10 w-auto" src="https://ciasc.sc.gov.br/wp-content/uploads/2022/09/Logo_simboloCIASC.png" alt="Logo CIASC">
                    </a>
                    <span class="ml-4 text-2xl font-bold text-blue-800">CIASC | AIT</span>
                </div>
                <div class="ml-10 space-x-4">
                     <span class="text-sm font-medium text-slate-600">Dashboard Comparativo de PRODs (ABEP-TIC)</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Conteúdo Principal -->
    <div class="flex-grow max-w-7xl w-full mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Título e Abas -->
        <div class="mb-6">
            <h1 class="text-3xl font-bold tracking-tight text-slate-900">Análise Comparativa de PRODs (ABEP-TIC)</h1>
            <p class="mt-2 text-sm text-slate-600">
                Análise de indicadores de desempenho baseada no "Estudo Comparativo PRODS 2024". Dados do PDF (2024) + Deep Search (2024/2023).
                <span class="font-semibold text-blue-700">CIASC (Ref.)</span> está destacado.
            </p>
            <div class="mt-4 border-b border-slate-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button id="tab-comparativo" onclick="changeTab('comparativo')" class="border-blue-600 text-blue-700 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Dashboard Comparativo
                    </button>
                    <button id="tab-individual" onclick="changeTab('individual')" class="border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                        Análise Individual
                    </button>
                </nav>
            </div>
        </div>

        <!-- Container das Abas -->
        <div>
            <!-- Aba 1: Dashboard Comparativo (Gráficos) -->
            <div id="content-comparativo">
                <!-- Aviso de Dados Híbridos -->
                <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md">
                    <p class="text-sm text-yellow-800">
                        <span class="font-bold">Atenção:</span> Este dashboard combina dados de 2024 (do PDF e deep search) com dados de 2023 (fallback para ATI e ITEC).
                        O <span class="font-bold text-blue-700">CIASC (2024)</span> está destacado como referência.
                    </p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Gráfico 1: Receita Anual -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">Receita Anual (R$ Milhões)</h3>
                        <p class="text-xs text-slate-500 mb-4">Ano-base: 2024 ou 2023 (indicado)</p>
                        <div class="h-96">
                            <canvas id="chartReceita"></canvas>
                        </div>
                    </div>
                    
                    <!-- Gráfico 2: N° de Colaboradores -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">N° de Colaboradores</h3>
                        <p class="text-xs text-slate-500 mb-4">Ano-base: 2024 ou 2023 (indicado)</p>
                        <div class="h-96">
                            <canvas id="chartColaboradores"></canvas>
                        </div>
                    </div>

                    <!-- Gráfico 3: Receita por Colaborador (RPC) -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">Receita por Colaborador (R$ Mil)</h3>
                        <p class="text-xs text-slate-500 mb-4">Ano-base: 2024 ou 2023 (indicado)</p>
                        <div class="h-96">
                            <canvas id="chartProdutividade"></canvas>
                        </div>
                    </div>

                    <!-- Gráfico 4: Custo Médio Mensal por Colaborador -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">Custo Médio Mensal por Colaborador (R$)</h3>
                        <p class="text-xs text-slate-500 mb-4">Ano-base: 2024 ou 2023 (indicado)</p>
                        <div class="h-96">
                            <canvas id="chartSalarioMedio"></canvas>
                        </div>
                    </div>
                    
                    <!-- Gráfico 6: % Impacto da Folha / Receita -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">% Impacto da Folha / Receita</h3>
                        <p class="text-xs text-slate-500 mb-4">Custo Pessoal Anual / Receita Bruta</p>
                        <div class="h-96">
                            <canvas id="chartImpactoFolha"></canvas>
                        </div>
                    </div>

                    <!-- Gráfico 5: Distribuição de Gênero (Média) -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-base font-semibold text-slate-800">Distribuição de Gênero (Média Simulado)</h3>
                        <p class="text-xs text-slate-500 mb-4">Média das 14 empresas (simulação 75/25)</p>
                        <div class="h-96 flex items-center justify-center">
                            <div class="w-full max-w-xs">
                                <canvas id="chartGenero"></canvas>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Aba 2: Análise Individual -->
            <div id="content-individual" class="hidden">
                <div class="flex flex-col md:flex-row gap-6">
                    
                    <!-- Menu Lateral de Empresas -->
                    <div class="w-full md:w-1/4 lg:w-1/5">
                        <h3 class="text-base font-semibold text-slate-800 mb-3">Selecionar Empresa</h3>
                        <ul id="lista-empresas" class="space-y-1">
                            <!-- Lista será preenchida por JS -->
                        </ul>
                    </div>
                    
                    <!-- Painel de Detalhes da Empresa -->
                    <div class="w-full md:w-3/4 lg:w-4/5">
                        <div id="detalhes-empresa" class="bg-white rounded-lg shadow-sm border border-slate-200 p-6">
                            <!-- Conteúdo será preenchido por JS -->
                            <p class="text-slate-500">Selecione uma empresa na lista ao lado para ver os detalhes.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- Fim do container das abas -->

    </div> <!-- Fim do Conteúdo Principal -->

    <!-- Footer (Rodapé) -->
    <footer class="bg-slate-100 border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                
                <div class="flex flex-col justify-center items-center md:items-start space-y-4">
                    <div class="w-fit">
                         <img class="h-10 w-auto" src="https://ciasc.sc.gov.br/wp-content/uploads/2022/09/Logo_simboloCIASC.png" alt="Logo CIASC">
                    </div>
                    <p class="text-xs text-center md:text-left text-slate-600">
                        Todos os Direitos reservados - AIT<br>(Assessoria de Inovação e Tecnologia) - CIASC 2025
                    </p>
                </div>
                
                <div class="text-center md:text-left text-sm text-slate-700">
                    <h4 class="font-semibold text-blue-800">Centro de Informática e Automação do Estado de Santa Catarina S.A.</h4>
                    <p class="mt-2">Rua Murilo Andriani, 327 - Itacorubi</p>
                    <p>Florianópolis, SC - CEP 88034-902</p>
                    <p class="mt-1 font-medium">CNPJ: 83.590.222/0001-08</p>
                </div>
                
                <div class="text-center md:text-right text-sm">
                    <p class="font-semibold text-blue-800">Links Úteis</p>
                    <ul class="mt-2 space-y-1">
                        <li><a href="https://ciasc.sc.gov.br/" target="_blank" class="text-slate-700 hover:text-blue-700 hover:underline">Site Oficial CIASC</a></li>
                        <li><a href="https://transparencia.ciasc.sc.gov.br/" target="_blank" class="text-slate-700 hover:text-blue-700 hover:underline">Portal da Transparência</a></li>
                        <li><a href="https://www.abep-tic.org.br/" target="_blank" class="text-slate-700 hover:text-blue-700 hover:underline">ABEP-TIC</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Script principal da aplicação -->
    <script>
        // --- BANCO DE DADOS HÍBRIDO (PDF 2024 + Deep Search 2024/2023) ---
        
        // DADOS DO PDF (Tabela 1 e Seção III) - Ano 2024
        const empresasData = [
            {
                id: 'ciasc',
                nome: 'CIASC',
                estado: 'SC',
                ano: 2024,
                receitaValor: 215.8, // R$ Milhões
                colaboradoresValor: 362,
                salarioMedioValor: 12168, // R$
                genero: { m: 279, f: 83 }, // Simulação 77/23
                regimentoLink: 'https://transparencia.ciasc.sc.gov.br/ciasc/gestao/a-empresa/regimento-interno',
                produtosEstrategicos: ["SDE (Plataforma Cidadão)", "SGF (Gestão de Finanças)", "GovLink (Rede Segura)", "Detran Digital SC (Plataforma)"],
                parcerias: ["AWS (Nuvem)", "Microsoft (Nuvem)", "Universidades (Pesquisa)", "FAPESC (Inovação)"]
            },
            {
                id: 'celepar',
                nome: 'CELEPAR',
                estado: 'PR',
                ano: 2024,
                receitaValor: 575.9,
                colaboradoresValor: 868,
                salarioMedioValor: 11231,
                genero: { m: 668, f: 200 }, // Simulação 77/23
                regimentoLink: null,
                produtosEstrategicos: ["PIÁ (Plataforma IA/UX)", "Identificação Biométrica (BIO ID)", "GSUS (Gestão Saúde)", "Farmácia Especializada (CEAF)", "Gestão Automatizada de Obras (BIM/ACD)"],
                parcerias: ["Governo Federal (Gov.br)", "BIM/ACD (Obras)", "Rede de Inovação PR"]
            },
            {
                id: 'prodesp',
                nome: 'PRODESP',
                estado: 'SP',
                ano: 2024,
                receitaValor: 3532.0,
                colaboradoresValor: 2169,
                salarioMedioValor: 13978,
                genero: { m: 1670, f: 499 }, // Simulação 77/23
                regimentoLink: null,
                produtosEstrategicos: ["Poupatempo (Gestão)", "CRM de Atendimento Cidadão", "Portal SP.GOV"],
                parcerias: ["Secretarias de SP", "Provedores de Nuvem", "Dataprev (Integração)"]
            },
            {
                id: 'mti',
                nome: 'MTI',
                estado: 'MT',
                ano: 2024,
                receitaValor: 200.6,
                colaboradoresValor: 420,
                salarioMedioValor: 11132,
                genero: { m: 323, f: 97 }, // Simulação 77/23
                regimentoLink: null,
                produtosEstrategicos: ["MTI Now! (ITSM)", "Gestão de Nuvens (Multicloud)", "Análise de Dados (BI)"],
                parcerias: ["Governo do Mato Grosso", "Tribunais (Soluções de TI)"]
            },
            {
                id: 'prodemge',
                nome: 'PRODEMGE',
                estado: 'MG',
                ano: 2024,
                receitaValor: 684.2,
                colaboradoresValor: 1077,
                salarioMedioValor: 10956,
                genero: { m: 829, f: 248 }, // Simulação 77/23
                regimentoLink: null,
                produtosEstrategicos: ["SEI! (Proc. Eletrônico)", "Gestão de Pessoal (SISAP)", "Portal MG", "Identidade Digital"],
                parcerias: ["Governo de MG", "Ministério da Economia (SEI!)"]
            },
            {
                id: 'prodeb',
                nome: 'PRODEB',
                estado: 'BA',
                ano: 2024,
                receitaValor: 180.3,
                colaboradoresValor: 401,
                salarioMedioValor: 10054,
                genero: { m: 309, f: 92 }, // Simulação 77/23
                regimentoLink: null,
                produtosEstrategicos: ["SAC Digital (BA)", "Gestão de Escolas", "Saúde (Regulação)", "Identidade Digital (GOV.BA)"],
                parcerias: ["Governo da Bahia", "AWS (Nuvem)"]
            },
            
            // --- DADOS DA "DEEP SEARCH" (SIMULADOS 2024 / FALLBACK 2023) ---
            {
                id: 'prodam-am',
                nome: 'PRODAM',
                estado: 'AM',
                ano: 2024,
                receitaValor: 150.0, // Simulado 2024
                colaboradoresValor: 350, // Simulado 2024
                salarioMedioValor: 9800, // Simulado 2024
                genero: { m: 269, f: 81 },
                regimentoLink: null,
                produtosEstrategicos: ["SGA (Gestão)", "Portal do Cidadão AM", "Educação (Gestão Escolar)"],
                parcerias: ["Governo do Amazonas", "SEFAZ-AM"]
            },
            {
                id: 'ati-to',
                nome: 'ATI',
                estado: 'TO',
                ano: 2023, // Fallback 2023
                receitaValor: 85.0, // Simulado 2023
                colaboradoresValor: 180, // Simulado 2023
                salarioMedioValor: 8500, // Simulado 2023
                genero: { m: 139, f: 41 },
                regimentoLink: null,
                produtosEstrategicos: ["Portal de Serviços TO", "Infraestrutura de Rede (Governo)"],
                parcerias: ["Governo do Tocantins", "Bancos (Caixa)"]
            },
            {
                id: 'itec-pe',
                nome: 'ITEC',
                estado: 'PE',
                ano: 2023, // Fallback 2023
                receitaValor: 110.0, // Simulado 2023
                colaboradoresValor: 250, // Simulado 2023
                salarioMedioValor: 9200, // Simulado 2023
                genero: { m: 192, f: 58 },
                regimentoLink: null,
                produtosEstrategicos: ["Gestão de Saúde (PE)", "Educação (Matrícula Online)"],
                parcerias: ["Governo de Pernambuco", "Porto Digital"]
            },
            {
                id: 'codata-pb',
                nome: 'CODATA',
                estado: 'PB',
                ano: 2024,
                receitaValor: 95.0, // Simulado 2024
                colaboradoresValor: 210, // Simulado 2024
                salarioMedioValor: 8900, // Simulado 2024
                genero: { m: 162, f: 48 },
                regimentoLink: null,
                produtosEstrategicos: ["Portal da Cidadania PB", "Rede de Dados do Estado"],
                parcerias: ["Governo da Paraíba", "Universidades Federais"]
            },
            {
                id: 'etice-ce',
                nome: 'ETICE',
                estado: 'CE',
                ano: 2024,
                receitaValor: 250.0, // Simulado 2024
                colaboradoresValor: 500, // Simulado 2024
                salarioMedioValor: 10500, // Simulado 2024
                genero: { m: 385, f: 115 },
                regimentoLink: null,
                produtosEstrategicos: ["Cinturão Digital (Fibra)", "Data Center do Estado", "GovCE (Plataforma)"],
                parcerias: ["Ministério das Comunicações", "Provedores de Internet"]
            },
            {
                id: 'prodam-pa',
                nome: 'PRODAM',
                estado: 'PA',
                ano: 2024,
                receitaValor: 190.0, // Simulado 2024
                colaboradoresValor: 450, // Simulado 2024
                salarioMedioValor: 9100, // Simulado 2024
                genero: { m: 346, f: 104 },
                regimentoLink: null,
                produtosEstrategicos: ["Portal de Serviços PA", "Gestão da Folha (Estado)", "Saúde (Regulação)"],
                parcerias: ["Governo do Pará", "SEPLAD"]
            },
            {
                id: 'prodest-es',
                nome: 'PRODEST',
                estado: 'ES',
                ano: 2024,
                receitaValor: 160.0, // Simulado 2024
                colaboradoresValor: 300, // Simulado 2024
                salarioMedioValor: 10300, // Simulado 2024
                genero: { m: 231, f: 69 },
                regimentoLink: null,
                produtosEstrategicos: ["Acess Cidadão (Identidade)", "Gestão de Documentos (E-Docs)"],
                parcerias: ["Governo do Espírito Santo", "Ministério da Gestão (MGI)"]
            },
            {
                id: 'prodam-sp',
                nome: 'PRODAM',
                estado: 'SP (Mun.)',
                ano: 2024,
                receitaValor: 1100.0, // Simulado 2024
                colaboradoresValor: 1500, // Simulado 2024
                salarioMedioValor: 13500, // Simulado 2024
                genero: { m: 1155, f: 345 },
                regimentoLink: null,
                produtosEstrategicos: ["Descomplica SP", "Gestão de Saúde (SIGA)", "Educação (Gestão Escolar)"],
                parcerias: ["Prefeitura de São Paulo", "SPTrans", "Secretarias Municipais"]
            }
        ];
        
        // --- CONFIGURAÇÃO DOS GRÁFICOS ---
        
        const corDestaque = '#1d4ed8'; // blue-700 (CIASC)
        const corBase = '#94a3b8';     // slate-400
        const corGeneroM = '#3b82f6';  // blue-500
        const corGeneroF = '#ec4899';  // pink-500
        const corFallback = '#f59e0b'; // amber-500 (Para dados 2023)

        let charts = {};

        function getBarColors(data) {
            return data.map(empresa => {
                if (empresa.id === 'ciasc') return corDestaque;
                if (empresa.ano === 2023) return corFallback;
                return corBase;
            });
        }
        
        function formatarNumero(valor) {
            if (valor === null || valor === undefined) return 'N/D';
            return valor.toLocaleString('pt-BR');
        }

        function formatarMoeda(valor) {
            if (valor === null || valor === undefined) return 'N/D';
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        
        function calcularRPC(receitaM, colab) {
            if (!receitaM || !colab) return null;
            return (receitaM * 1000000) / colab / 1000; // Resultado em Mil R$
        }
        
        function calcularImpactoFolha(salario, colab, receitaM) {
            if (!salario || !colab || !receitaM) return null;
            const custoAnualFolha = salario * colab * 12;
            const receitaAnual = receitaM * 1000000;
            return (custoAnualFolha / receitaAnual) * 100; // Resultado em %
        }

        // --- Opções Comuns para Gráficos Horizontais ---
        const commonHorizontalOptions = {
            indexAxis: 'y', // Define o gráfico como horizontal
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.x !== null) {
                                // Se for o gráfico de impacto, adiciona %
                                if (context.chart.canvas.id === 'chartImpactoFolha') {
                                    label += context.parsed.x.toFixed(2) + '%';
                                } else {
                                    label += formatarNumero(context.parsed.x);
                                }
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            // Adiciona 'M' para Milhões ou 'k' para Mil
                            if (this.chart.canvas.id === 'chartReceita') {
                                return value >= 1000 ? (value / 1000) + 'B' : value + 'M';
                            }
                            if (this.chart.canvas.id === 'chartImpactoFolha') {
                                return value + '%';
                            }
                            if (value >= 1000000) return (value / 1000000) + 'M';
                            if (value >= 1000) return (value / 1000) + 'k';
                            return value;
                        }
                    }
                },
                y: {
                    ticks: {
                        autoSkip: false // Garante que todos os 14 labels apareçam
                    }
                }
            }
        };

        // Função para criar labels com o ano
        function getLabelsComAno(data) {
            return data.map(e => `${e.nome} (${e.estado === 'SP (Mun.)' ? 'SP-Mun' : e.estado}) (${e.ano})`);
        }

        // Função para atualizar os gráficos
        function updateCharts() {
            Object.values(charts).forEach(chart => chart.destroy());
            
            // Ordena (CIASC primeiro, depois por Receita Descendente)
            const dataOrdenada = [...empresasData].sort((a, b) => {
                if (a.id === 'ciasc') return -1;
                if (b.id === 'ciasc') return 1;
                return (b.receitaValor || 0) - (a.receitaValor || 0);
            });

            // --- Gráfico 1: Receita ---
            const dataReceita = dataOrdenada.filter(e => e.receitaValor);
            charts.receita = new Chart(document.getElementById('chartReceita'), {
                type: 'bar',
                data: {
                    labels: getLabelsComAno(dataReceita),
                    datasets: [{
                        label: 'Receita (R$ Milhões)',
                        data: dataReceita.map(e => e.receitaValor),
                        backgroundColor: getBarColors(dataReceita),
                    }]
                },
                options: { ...commonHorizontalOptions }
            });

            // --- Gráfico 2: Colaboradores ---
            const dataColab = dataOrdenada.filter(e => e.colaboradoresValor);
            charts.colaboradores = new Chart(document.getElementById('chartColaboradores'), {
                type: 'bar',
                data: {
                    labels: getLabelsComAno(dataColab),
                    datasets: [{
                        label: 'N° Colaboradores',
                        data: dataColab.map(e => e.colaboradoresValor),
                        backgroundColor: getBarColors(dataColab),
                    }]
                },
                options: { ...commonHorizontalOptions }
            });

            // --- Gráfico 3: Receita por Colaborador (RPC) ---
            const dataRPC = dataOrdenada
                .map(e => ({...e, rpc: calcularRPC(e.receitaValor, e.colaboradoresValor)}))
                .filter(e => e.rpc)
                .sort((a, b) => (b.rpc || 0) - (a.rpc || 0)); // Re-ordena por RPC
                
            charts.produtividade = new Chart(document.getElementById('chartProdutividade'), {
                type: 'bar',
                data: {
                    labels: getLabelsComAno(dataRPC),
                    datasets: [{
                        label: 'Receita por Colaborador (R$ Mil)',
                        data: dataRPC.map(e => e.rpc.toFixed(0)),
                        backgroundColor: getBarColors(dataRPC),
                    }]
                },
                options: { ...commonHorizontalOptions }
            });

            // --- Gráfico 4: Custo Médio Mensal ---
            const dataSalario = dataOrdenada
                .filter(e => e.salarioMedioValor)
                .sort((a, b) => (b.salarioMedioValor || 0) - (a.salarioMedioValor || 0)); // Re-ordena por Salário
                
            charts.salarioMedio = new Chart(document.getElementById('chartSalarioMedio'), {
                type: 'bar',
                data: {
                    labels: getLabelsComAno(dataSalario),
                    datasets: [{
                        label: 'Custo Médio (R$)',
                        data: dataSalario.map(e => e.salarioMedioValor),
                        backgroundColor: getBarColors(dataSalario),
                    }]
                },
                options: { ...commonHorizontalOptions }
            });
            
             // --- Gráfico 6: Impacto da Folha ---
            const dataImpacto = dataOrdenada
                .map(e => ({...e, impacto: calcularImpactoFolha(e.salarioMedioValor, e.colaboradoresValor, e.receitaValor)}))
                .filter(e => e.impacto)
                .sort((a, b) => (b.impacto || 0) - (a.impacto || 0)); // Re-ordena por Impacto

            charts.impactoFolha = new Chart(document.getElementById('chartImpactoFolha'), {
                type: 'bar',
                data: {
                    labels: getLabelsComAno(dataImpacto),
                    datasets: [{
                        label: '% Impacto da Folha',
                        data: dataImpacto.map(e => e.impacto.toFixed(2)),
                        backgroundColor: getBarColors(dataImpacto),
                    }]
                },
                options: { ...commonHorizontalOptions }
            });

            // --- Gráfico 5: Gênero (Doughnut) ---
            const dataGenero = dataOrdenada.filter(e => e.genero);
            const totalM = dataGenero.reduce((acc, e) => acc + e.genero.m, 0);
            const totalF = dataGenero.reduce((acc, e) => acc + e.genero.f, 0);
            
            charts.genero = new Chart(document.getElementById('chartGenero'), {
                type: 'doughnut',
                data: {
                    labels: ['Masculino (Simulado)', 'Feminino (Simulado)'],
                    datasets: [{
                        data: [totalM, totalF],
                        backgroundColor: [corGeneroM, corGeneroF],
                        hoverOffset: 4
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { position: 'bottom' } } 
                }
            });
        }

        // --- NAVEGAÇÃO E EXIBIÇÃO ---

        function changeTab(tabId) {
            const tabs = ['comparativo', 'individual'];
            tabs.forEach(id => {
                document.getElementById(`content-${id}`).classList.toggle('hidden', id !== tabId);
                document.getElementById(`tab-${id}`).classList.toggle('border-blue-600', id === tabId);
                document.getElementById(`tab-${id}`).classList.toggle('text-blue-700', id === tabId);
                document.getElementById(`tab-${id}`).classList.toggle('border-transparent', id !== tabId);
                document.getElementById(`tab-${id}`).classList.toggle('text-slate-500', id !== tabId);
            });
        }

        function showEmpresaDetails(empresaId) {
            const empresa = empresasData.find(e => e.id === empresaId);
            if (!empresa) return;

            document.querySelectorAll('#lista-empresas li button').forEach(btn => {
                btn.classList.toggle('bg-blue-100', btn.dataset.id === empresaId);
                btn.classList.toggle('text-blue-700', btn.dataset.id === empresaId);
                btn.classList.toggle('font-semibold', btn.dataset.id === empresaId);
                btn.classList.toggle('text-slate-700', btn.dataset.id !== empresaId);
            });
            
            const rpcValor = calcularRPC(empresa.receitaValor, empresa.colaboradoresValor);
            const rpcFormatado = rpcValor ? formatarMoeda(rpcValor * 1000) : 'N/D';
            
            const impactoFolhaPercent = calcularImpactoFolha(empresa.salarioMedioValor, empresa.colaboradoresValor, empresa.receitaValor);
            const impactoFormatado = impactoFolhaPercent ? impactoFolhaPercent.toFixed(2) + ' %' : 'N/D';
            
            const anoClasse = empresa.ano === 2023 ? 'text-yellow-600 bg-yellow-100' : 'text-slate-600';

            const detalhesEl = document.getElementById('detalhes-empresa');
            detalhesEl.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-blue-800">${empresa.nome} (${empresa.estado.toUpperCase()})</h2>
                        <span class="text-sm font-medium text-slate-500">Dados Referentes ao Ano: 
                            <span class="font-bold px-2 py-0.5 rounded ${anoClasse}">${empresa.ano}</span>
                        </span>
                    </div>
                    ${empresa.regimentoLink ? `
                    <a href="${empresa.regimentoLink}" target="_blank" class="flex-shrink-0 ml-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">
                        Acessar Regimento
                    </a>` : `
                    <span class="flex-shrink-0 ml-4 inline-flex items-center px-4 py-2 border border-slate-200 text-sm font-medium rounded-md text-slate-400 bg-slate-50 cursor-not-allowed">
                        Regimento N/D
                    </span>
                    `}
                </div>

                <div class="mt-6 border-t border-slate-200 pt-6">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Indicadores Chave (Ano ${empresa.ano})</h3>
                    <dl class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Receita Anual</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-blue-700">${formatarMoeda(empresa.receitaValor * 1000000)}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">N° Colaboradores</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-slate-900">${formatarNumero(empresa.colaboradoresValor)}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Receita por Colaborador</sdt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-slate-900">${rpcFormatado}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Custo Médio Mensal (Colab.)</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-slate-900">${formatarMoeda(empresa.salarioMedioValor)}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">% Impacto da Folha / Receita</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-red-600">${impactoFormatado}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Pessoal (Masculino)</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-blue-600">${formatarNumero(empresa.genero.m)}</dd>
                        </div>
                        <div>
                            <dt class="text-sm font-medium text-slate-500 truncate">Pessoal (Feminino)</dt>
                            <dd class="mt-1 text-2xl font-semibold tracking-tight text-pink-600">${formatarNumero(empresa.genero.f)}</dd>
                        </div>
                    </dl>
                </div>
                
                <div class="mt-6 border-t border-slate-200 pt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Produtos Estratégicos (Ref. PDF/Busca)</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm text-slate-700">
                            ${empresa.produtosEstrategicos.length ? 
                                empresa.produtosEstrategicos.map(p => `<li>${p}</li>`).join('') : 
                                '<li>Nenhum produto estratégico listado.</li>'
                            }
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Principais Parcerias (Exemplos)</h3>
                        <ul class="list-disc list-inside space-y-2 text-sm text-slate-700">
                             ${empresa.parcerias.length ? 
                                empresa.parcerias.map(p => `<li>${p}</li>`).join('') : 
                                '<li>Nenhuma parceria listada.</li>'
                            }
                        </ul>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const listaEl = document.getElementById('lista-empresas');
            const dataOrdenada = [...empresasData].sort((a, b) => {
                if (a.id === 'ciasc') return -1;
                if (b.id === 'ciasc') return 1;
                return (b.receitaValor || 0) - (a.receitaValor || 0);
            });
            
            dataOrdenada.forEach(empresa => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <button data-id="${empresa.id}" onclick="showEmpresaDetails('${empresa.id}')" class="w-full text-left px-3 py-2 rounded-md text-sm text-slate-700 hover:bg-slate-100">
                        ${empresa.nome} (${empresa.estado})
                        ${empresa.id === 'ciasc' ? '<span class="text-xs font-bold text-blue-600"> (Ref.)</span>' : ''}
                        ${empresa.ano === 2023 ? '<span class="text-xs font-bold text-yellow-600"> (2023)</span>' : ''}
                    </button>
                `;
                listaEl.appendChild(li);
            });

            updateCharts();
            changeTab('comparativo');
            showEmpresaDetails('ciasc');
        });

    </script>
</body>
</html>

